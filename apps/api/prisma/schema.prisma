generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          Int      @id @default(autoincrement())
  githubId    String   @unique
  username    String?
  email       String?  @unique
  avatarUrl   String?
  accessToken String?
  createdAt   DateTime @default(now())

  repos       Repo[]
}

model Repo {
  id          Int       @id @default(autoincrement())
  githubId    String    @unique
  name        String
  fullName    String
  htmlUrl     String
  description String?
  language    String?
  private     Boolean
  fork        Boolean
  autoAudit   Boolean   @default(false)
  ownerId     Int
  createdAt   DateTime  @default(now())

  User        User      @relation(fields: [ownerId], references: [id])
  commits     Commit[]
}

model Commit {
  id        Int      @id @default(autoincrement())
  sha       String   @unique
  message   String
  author    String
  date      DateTime

  repoId    Int
  Repo      Repo     @relation(fields: [repoId], references: [id], onDelete: Cascade)

  files     CommitFile[] 

  @@index([repoId, date])
}

model CommitFile {
  id        Int      @id @default(autoincrement())
  sha       String   @unique
  path      String
  content   String
  commitId  Int
  Commit    Commit   @relation(fields: [commitId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
